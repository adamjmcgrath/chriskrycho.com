<!DOCTYPE html>
<html lang="en">
<head>
    <title>How to Build a Single-Page App API Right &middot; Chris Krycho</title>
    <meta name="description" content="How to write a single-page app API so that you get usable data on the first load *and* have a nice interface for you Ember/Angular/etc. app."/>

    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

<link rel='me' href='https://alpha.app.net/chriskrycho' data-type='follow' data-user-id='@chriskrycho'/>    <meta property="og:url" content="../drafts/how-to-build-a-single-page-app-api-right.html"/>
    <meta property="og:title" content="How to Build a Single-Page App API Right"/>
    <meta property="og:description" content="How to write a single-page app API so that you get usable data on the first load *and* have a nice interface for you Ember/Angular/etc. app."/>
        <meta property="og:image" content="..//assets/images/ck.png"/>
<link rel="author" href=""/><meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@chriskrycho"/>
<meta name="twitter:creator" content="@chriskrycho"/>
    <meta name="twitter:title" content="How to Build a Single-Page App API Right"/>
    <meta name="twitter:description" content=""/>
        <meta name="twitter:image" content="../assets/images/ck.png"/>

    <link rel="stylesheet" type="text/css" href="../assets/style.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/fonts.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/icons.css"/>

    <link href="/favicon.png" type="image/png" rel="icon" />
    <link href="/favicon.ico" type="image/ico" rel="icon" />

</head>
<body>
    <header id="site-header">
        <div class="hgroup">
            <h1 id="site-title">
<a href=".."><img class="logotype" src="/assets/images/ck.png" alt="ck"/>Chris Krycho</a>
</h1>

            <h2 id="site-subtitle">Creativity, reflection, & varied endeavors<br class="optional"/> by a peculiar fellow</h2>
        </div>

        <nav>
            <ul>
                <li class="section-title"><a href="../about.html">About</a></li>
                <li class="section-title"><a href="../art/">art</a></li>
                <li class="section-title"><a href="../blog/">blog</a></li>
                <li class="section-title"><a href="../talks/">talks</a></li>
                <li class="section-title"><a href="../tech/">tech</a></li>
                <li class="section-title"><a href="../theology/">theology</a></li>
            </ul>
        </nav>

    </header>


<article class="software-development tech">

    <header>
<h1>How to Build a Single-Page App API <em>Right</em></h1>
<h2>Or: Get Performance, Progressive Enhancement, and SEO for Free!</h2>    </header>

    <div class="meta"><span class="date"><a href="../drafts/how-to-build-a-single-page-app-api-right.html"><i class="fa fa-fw fa-link"></i></a>June 09, 2015</span><span class="section">Filed under <a class="section-title" href="../tech/">tech</a></span><span class="hashtag"><a class="hashtags" href="../software-development/">#software development</a></span><span><a href="../2015/how-to-build-a-single-page-app-api-right.txt">Markdown source</a></span></div>

    <div class="content-wrapper">


        <div class="content">

<p>When I was first working on HolyBible.com, I struggled for quite a while to wrap my head around the right way to structure its API—and in truth, I actually didn’t come up with what I would call the <em>right</em> solution. I came up with a <em>working</em> solution, and the site performs all right, most of the time. However, our goal as developers shouldn’t be “all right, most of the time.” It should be “really well, all the time.”</p>
<h2 id="the-mistake">The mistake</h2>
<p>Here’s the mistake I made: I built the Bible data API as a <em>single</em></p>
<p>… TODO</p>
<h2 id="the-solution">The solution</h2>
<p>Don’t write <em>one</em> API. Write <em>two</em>. They should be structured nearly identically, but one of them will be a <em>page</em> API endpoint, and one will be a <em>data</em> API endpoint. In the context of HolyBible.com, here’s how that would play out.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> One endpoint would be based purely on the standard URL, something like this:</p>
<pre><code>holybible.com/gen.1.1</code></pre>
<p>The other would be to retrieve a set of <em>data</em> associated with a given address:</p>
<pre><code>holybible.com/data/gen.1.1</code></pre>
<p>Any normal page load will simply trigger a <code>GET</code> at <code>gen.1.1</code>. The back end must have a route handler to catch and parse this kind of URL. It should render a full page, populated with all the appropriate content—in this case, probably something like Genesis 1<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>—and return that to the browser. Upon arrival at the browser, the single page application can spin up. At that point, it can load any required session data, etc. and proceed normally.</p>
<p>Now, once the application has spun up, it can manage clicks on the page, etc. and call the <em>data</em> API. So, for example, if there is a navigation control on the page (as there is on HolyBible.com), clicking to navigate to Job 14 could, instead of calling the full <code>GET</code>, fetch the data from the other endpoint by running an AJAX request to <code>/data/job.14</code>.</p>
<p>On the back end, your application should supply a separate route to match this <code>/data/&lt;reference&gt;</code> path. The same kind of parsing could be done to determine what data should be returned, allowing you to reuse the logic for the standard page requests. However, rather than rendering a template with all the content embedded, you would instead simply return JSON (or XML, or whatever else you prefer) with the relevant data. Then the application on the front end can update the content of the page with a client-side render and</p>
<p>This approach has two big advantages over the catch-all approach that was frequently recommended in e.g. Angular SPA tutorials I read.</p>
<ol type="1">
<li><p>It’s <em>progressive enhancement</em>. If the JavaScript fails, or the user has it disabled, or it fails to load because it’s loaded asynchronously, the user still gets the page they asked for. Moreover, as long as the page content is build carefully (links built appropriately for other content, and so on), the entire application could continue to work even if the JavaScript <em>never</em> becomes available.</p></li>
<li><p>It’s <em>performant</em>. Loading the content this way will be <em>much</em> faster than the standard approach recommended for single-page apps.</p></li>
</ol>
<p>… TODO</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Note: this is <em>not</em> the actual API structure of HolyBible.com, or even particularly close to it. Remember, I learned everything I’m writing here by doing it <em>wrong</em>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Or possibly 1:1–2:3, which constitutes a semantic block of data. I have some thoughts on chunking Bible data semantically rather than by chapter and verse for this kind of thing. That’s another post for another day, though.<a href="#fnref2">↩</a></p></li>
</ol>
</section>
        </div>
    </div>
</article>


    <footer id="site-footer"><section id="connect">
    <h1>Connect</h1>
    <h2>Social</h2>
    <ul class="icons">
        <li><a href="https://app.net/chriskrycho"><i class="fa fa-fw fa-adn"></i>App.net</a></li>
        <li><a href="https://twitter.com/chriskrycho"><i class="fa fa-fw fa-twitter"></i>Twitter</a></li>
        <li><a href="https://www.facebook.com/chriskrycho"><i class="fa fa-fw fa-facebook"></i>Facebook</a></li>
        <li><a href="https://soundcloud.com/chriskrycho"><i class="fa fa-fw fa-cloud"></i>SoundCloud</a></li>
        <li><a href="http://instagram.com/chriskrycho"><i class="fa fa-fw fa-instagram"></i>Instagram</a></li>
        <li><a href="http://www.linkedin.com/in/chriskrycho"><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a></li>
        <li><a href="https://vimeo.com/chriskrycho"><i class="fa fa-fw fa-vimeo"></i>Vimeo</a></li>
    </ul>
    <h2>Software</h2>
    <ul class="icons">
        <li><a href="https://github.com/chriskrycho"><i class="fa fa-fw fa-github"></i>GitHub</a></li>
        <li><a href="https://bitbucket.org/chriskrycho"><i class="fa fa-fw fa-bitbucket"></i>Bitbucket</a></li>
        <li><a href="http://stackoverflow.com/users/564181/chris-krycho"><i class="fa fa-fw fa-stack-overflow"></i>Stack Overflow</a></li>
    </ul>
</section>
<section id="navigate">
    <h1>Navigate</h1>
    <h2>Read</h2>
    <ul>
        <li><a href="../archives.html">Everything</a></li>
        <li class="section-title"><a href="../art/">art</a></li>
        <li class="section-title"><a href="../blog/">blog</a></li>
        <li class="section-title"><a href="../micro/">micro</a></li>
        <li class="section-title"><a href="../talks/">talks</a></li>
        <li class="section-title"><a href="../tech/">tech</a></li>
        <li class="section-title"><a href="../theology/">theology</a></li>
    </ul>
    <h2>Get Updates</h2>
    <ul class="inline">
        <li class="section-title">Everything</li>
        <li><a href="../None"><i class="fa fa-rss"></i>Feed</a></li>
        <li><a href="https://broadcast.app.net/46224/chriskrychocom-all/"><i class="fa fa-envelope-o"></i>Subscribe</a></li>
    </ul>
    <ul class="inline">
        <li class="section-title">art</li>
        <li><a href="../feeds/art.xml"><i class="fa fa-rss"></i>Feed</a></li>
        <li><a href="https://broadcast.app.net/46225/chriskrychocom-art/"><i class="fa fa-envelope-o"></i>Subscribe</a></li>
    </ul>
    <ul class="inline">
        <li class="section-title">blog</li>
        <li><a href="../feeds/blog.xml"><i class="fa fa-rss"></i>Feed</a></li>
        <li><a href="https://broadcast.app.net/46226/chriskrychocom-blog/"><i class="fa fa-envelope-o"></i>Subscribe</a></li>
    </ul>
    <ul class="inline">
        <li class="section-title">micro</li>
        <li><a href="../feeds/micro.xml"><i class="fa fa-rss"></i>Feed</a></li>
        <li><a href=""><i class="fa fa-envelope-o"></i>Subscribe</a></li>
    </ul>
    <ul class="inline">
        <li class="section-title">talks</li>
        <li><a href="../feeds/talks.xml"><i class="fa fa-rss"></i>Feed</a></li>
        <li><a href=""><i class="fa fa-envelope-o"></i>Subscribe</a></li>
    </ul>
    <ul class="inline">
        <li class="section-title">tech</li>
        <li><a href="../feeds/tech.xml"><i class="fa fa-rss"></i>Feed</a></li>
        <li><a href="https://broadcast.app.net/46227/chriskrychocom-tech/"><i class="fa fa-envelope-o"></i>Subscribe</a></li>
    </ul>
    <ul class="inline">
        <li class="section-title">theology</li>
        <li><a href="../feeds/theology.xml"><i class="fa fa-rss"></i>Feed</a></li>
        <li><a href="https://broadcast.app.net/46228/chriskrychocom-theology/"><i class="fa fa-envelope-o"></i>Subscribe</a></li>
    </ul>
</section>
<section id="recent">
    <h1>Recent</h1>
        <h2 class="section-title">art</h2>
        <ul>
            <li><a href="../2015/to-grow-older.html">To Grow Older</a></li>
            <li><a href="../2015/easier.html">Easier</a></li>
            <li><a href="../2015/airship.html">Airship</a></li>
    </ul>
        <h2 class="section-title">blog</h2>
        <ul>
            <li><a href="../2015/these-are-my-people.html">These Are My People</a></li>
            <li><a href="../2015/the-brutality-of-police-culture-in-baltimore.html">The Brutality of Police Culture in Baltimore</a></li>
            <li><a href="../2015/small-caps-and-margins.html">Small Caps and Margins</a></li>
    </ul>
    </ul>
        <h2 class="section-title">talks</h2>
        <ul>
            <li><a href="../2015/tolle-lege.html">Tolle Lege!</a></li>
    </ul>
        <h2 class="section-title">tech</h2>
        <ul>
            <li><a href="../2015/corporate-and-government-surveillance.html">Corporate and Government Surveillance</a></li>
            <li><a href="../2015/ctypes-structures-and-dll-exports.html">Python Enums, ctypes.Structures, and DLL exports</a></li>
            <li><a href="../2015/open-source-is-neat.html">Open Source is Neat</a></li>
    </ul>
        <h2 class="section-title">theology</h2>
        <ul>
            <li><a href="../2015/strong-group-cultures-are-broken-too.html">Strong-Group Cultures are Broken, Too</a></li>
            <li><a href="../2015/a-particular-way-of-imagining-the-world.html">A Particular Way of Imagining the World</a></li>
            <li><a href="../2015/a-paradigmatic-instance-of-treachery.html">A Paradigmatic Instance of Treachery</a></li>
    </ul>
</section></footer>

    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.0.min.js"></script>
    <script type="text/javascript" src="/assets/js/bigfoot.min.js"></script>
    <script type="text/javascript">$.bigfoot({'actionOriginalFN': 'ignore'});</script>
         <script type="text/javascript" src="/assets/js/highlight.pack.js"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
    <script src="/assets/js/reftagger.js"></script>

    <script>
        !function(g,s,q,r,d){r=g[r]=g[r]||function(){(r.q=r.q||[]).push(
        arguments)};d=s.createElement(q);q=s.getElementsByTagName(q)[0];
        d.src='//d1l6p2sc9645hc.cloudfront.net/tracker.js';q.parentNode.
        insertBefore(d,q)}(window,document,'script','_gs');

        _gs('GSN-862423-O');
    </script>
</body>
</html>